<!DOCTYPE html>
{% load staticfiles %}
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Ostinato Editor</title>
    <link href="{{ EDITOR_CSS_PATH }}" rel="stylesheet">
    <style>
      body {
        margin: 0;
        padding: 0;
        overflow: overflow-y;
      }

      #editor {
        margin: 16px;
        box-sizing: inline-block;
        position: relative;
        overflow: visible;
      }
    </style>
  </head>

  <body>
    <div id="editor"></div>

    <script type="module">
      import '{{ editorjs_import }}';

      function handleEditorMessages(msg) {
        import(msg.configPath).then(function(m) {
          var config = m.editorConfig;
          var editor;

          config.holder = 'editor';

          config.onChange = function() {
            editor.save().then((outputData) => {
              if (outputData) window.parent.postMessage({
                editorSaved: outputData,
              });
            });
          };

          if (msg.data) {
            config.data = msg.data;
          }

          editor = new EditorJS(config);
        });
      }

      window.addEventListener("message", function(ev) {
        if (ev.data) {
          if (ev.data.editor) handleEditorMessages(ev.data.editor);
        }
      });
    </script>
  </body>
</html>
