<!DOCTYPE html>
{% load staticfiles %}
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Ostinato Editor</title>
    <link href="{{ EDITOR_CSS_PATH }}" rel="stylesheet">
    <style>
      body {
        margin: 0;
        padding: 0;
        overflow: overflow-y;
      }

      #editor {
        margin: 16px;
        margin-bottom: 80px;
        box-sizing: inline-block;
        position: relative;
        overflow: visible;
      }

      .ce-block {
        position: relative;
        box-sizing: border-box;
        padding: 1px 0 0;
      }

      .ce-block::before {
        content: "";
        display: block;
        position: absolute;
        left: 0;
        top: 4px;
        /* top: calc(50% - 10px); */
        /* height: 20px; */
        bottom: 4px;
        width: 2px;
        background-color: #417690;
      }

      .ce-block--focused::before {
        width: 4px;
        background-color: #79aec8;
      }
    </style>
  </head>

  <body>
    <div id="editor"></div>

    <script type="module">
      import '{{ editorjs_import }}';

      function handleEditorMessages(msg) {
        import(msg.configPath).then(function(m) {
          var config = m.editorConfig;
          var editor;

          config.holder = 'editor';

          config.onChange = function() {
            editor.save().then((outputData) => {
              if (outputData) window.parent.postMessage({
                editorSaved: outputData,
              });
            });
          };

          if (msg.data) {
            config.data = msg.data;
          }

          editor = new EditorJS(config);
          editor.isReady.then(() => {
            // TODO: After editor was loaded, inject our styles so that they
            // override the editor styles.

            window.parent.postMessage({editorReady: true});
          })

        });
      }

      window.addEventListener("message", function(ev) {
        // TODO - SECURITY! Make sure we verify domain here
        if (ev.data) {
          if (ev.data.editor) handleEditorMessages(ev.data.editor);
        }
      });
    </script>
  </body>
</html>
