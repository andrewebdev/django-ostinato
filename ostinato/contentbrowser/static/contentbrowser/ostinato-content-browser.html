<link rel="import" href="/static/ostinato/bower_components/polymer/polymer.html">

<link rel="import" href="/static/ostinato/bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="/static/ostinato/bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="/static/ostinato/bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="/static/ostinato/bower_components/iron-icons/iron-icons.html">
<link rel="import" href="/static/ostinato/bower_components/iron-selector/iron-selector.html">
<link rel="import" href="/static/ostinato/bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="/static/ostinato/bower_components/iron-overlay-behavior/iron-overlay-behavior.html">
<link rel="import" href="/static/ostinato/bower_components/paper-spinner/paper-spinner.html">
<link rel="import" href="/static/ostinato/bower_components/paper-icon-button/paper-icon-button.html">


<style is="custom-style" include="iron-flex iron-flex-alignment"></style>


<dom-module id="cb-item">
    <style>
        :host {
            @apply(--layout-vertical);
            @apply(--layout-center-justified);
            @apply(--layout-center);

            box-sizing: border-box;
            background-color: #fafafa;
            text-align: center;
            padding: 5px;
            margin: 1em;
            width: 100px;
            height: 100px;
            cursor: pointer;
            border: 1px solid #e8e8e8;
        }
        :host:hover {
            background-color: #e3e3e3;
        }
    </style>
    <template>
        <content></content>
    </template>
</dom-module>
<script>
    (function() {
        'use strict';

        Polymer({
            is: 'cb-item',

            ready: function() {
                this.content = Polymer.dom(this).querySelector('textarea');
                this.content.disabled = true;
                this.content.style = 'display: none;';
            },

            properties: {
                browser: String,
                item: String,
                fieldName: String
            },

            listeners: {
                'click': '_handleClick'
            },

            _handleClick: function(e) {
                // For now we only handle a insert event, but we might
                // extend this in future to allow for things like preview?
                cbInsertAction(this.browser, this.fieldName, this.content.value);
            }
        });

    })();
</script>


<dom-module id="ostinato-cb-category">
    <style>
        :host {
            position: relative;
            display: block;
        }
        a {
            display: block;
            padding: 0.5em 2em;
            font-weight: bold;
        }
        a:hover,
        :host.iron-selected a {
            background-color: #e3e3e3;
        }
    </style>
    <template>
        <a href="#" on-click="_handleClick">{{title}}</a>
    </template>
</dom-module>
<script>
    (function() {
        'use strict';

        Polymer({
            is: 'ostinato-cb-category',

            properties: {
                widget: String,
                browser: String,
                url: String,
                title: String,
                description: String
            },

            _handleClick: function(e) {
                e.preventDefault();
                var widget = document.querySelector("#_cb" + this.widget);
                widget.loadBrowser(this.url);
            }
        });

    })();
</script>



<dom-module id="ostinato-cb-browser">
    <style include="iron-flex iron-flex-alignment">
        :host {
            @apply(--layout-vertical);
            background-color: white;
            border: 1px solid #e8e8e8;
            width: 800px;
            height: 50%;
        }
        app-toolbar {
            background-color: #79AEC8;
            color: white;
            --paper-icon-button-ink-color: white;
        }
        #browser {
            @apply(--layout-horizontal);
            @apply(--layout-flex);
        }
        #browserList {
            @apply(--layout-vertical);
            background-color: #f8f8f8;
        }
        paper-header-panel {
            @apply(--layout-flex);
        }
        #items {
            @apply(--layout-flex);
            @apply(--layout-horizontal);
            @apply(--layout-wrap);
            height: 100%;
        }
        p.info {
            margin: 2em;
            font-size: 18px;
            color: #c3c3c3;
        }
    </style>
    <template>
        <iron-ajax id="browserXHR"
                   method="get"
                   handle-as="text"
                   headers='{"X-Requested-With": "XMLHttpRequest"}'
                   on-response="_handleResponse"
                   on-error="_handleError"></iron-ajax>

        <app-toolbar>
            <div title>Content Browser</div>
            <paper-icon-button on-click="_handleClose" icon="close"></paper-icon-button>
        </app-toolbar>

        <div id="browser">

            <div id="browserList">
                <iron-selector attr-for-selected="browser">
                <content></content>
                </iron-selector>
            </div>

            <div id="items">
                <p class="info">Please choose a category on the left.</p>
            </div>
        </div>
    </template>
</dom-module>
<script>
    (function() {
        'use strict';

        Polymer({
            is: 'ostinato-cb-browser',
            behaviors: [
                Polymer.IronOverlayBehavior
            ],

            properties: {
                fieldName: String
            },

            loadBrowser: function(url) {
                this.$.items.innerHTML = "<paper-spinner active></paper-spinner>";
                this.$.browserXHR.url = url;
                this.$.browserXHR.params = {field_name: this.fieldName};
                this.$.browserXHR.generateRequest();
            },

            _handleClose: function(e) {
                this.close();
            },

            _handleResponse: function(e, data) {
                var resp = this.$.browserXHR.lastResponse;
                this.$.items.innerHTML = resp;
            }

        });

    })();
</script>
